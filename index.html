<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>People Can Vote</title>
<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; }
  #boot { position: fixed; bottom: 10px; left: 10px; font-size: 12px; color: #555; background: rgba(255,255,255,0.9); padding: 6px 8px; border-radius: 8px; }
</style>
</head>
<body>
<div id="app">
  <h1>People Can Vote</h1>
  <div id="content">Načítání…</div>
</div>
<div id="boot">Booting…</div>

<script>
/* ====== ZÁKLADNÍ OCHRANY ====== */
if (window.__PCV_INIT_DONE__) {
  console.warn("PCV: init already done");
} else {
  window.__PCV_INIT_DONE__ = true;

  function boot(msg) {
    const el = document.getElementById("boot");
    if (el) el.textContent = msg;
    console.log(msg);
  }

  /* ====== STUB FUNKCE (UI) ====== */
  function renderContinentsBar() {}
  function renderCountriesForContinent() {}
  function setContinentPill() {}

  /* ====== SUPABASE LOADER ====== */
  async function loadSupabase() {
    boot("Init: loading Supabase…");
    return new Promise((resolve, reject) => {
      const s = document.createElement("script");
      s.src = "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2";
      s.async = true;
      s.onload = () => resolve(window.supabase);
      s.onerror = () => reject(new Error("Supabase load failed"));
      document.head.appendChild(s);
      setTimeout(() => reject(new Error("Supabase load timeout")), 12000);
    });
  }

  /* ====== INIT ====== */
  (async function init() {
    try {
      boot("Init: JS running");

      const supabaseLib = await loadSupabase();
      if (!supabaseLib) throw new Error("Supabase not available");

      const SUPABASE_URL = "https://jqoomnhpyuikbntnrukw.supabase.co";
      const SUPABASE_ANON_KEY = "sb_publishable_SjZ_HQWN0XRE9ebbf_OwQg_kmJeS43h";

      const supabaseClient = supabaseLib.createClient(
        SUPABASE_URL,
        SUPABASE_ANON_KEY
      );

      boot("Init: Supabase ready");

      // Session check (safe)
      try {
        const { data } = await supabaseClient.auth.getSession();
        console.log("Session:", data && data.session);
      } catch (e) {
        console.warn("Session check failed:", e);
      }

      document.getElementById("content").textContent =
        "Aplikace běží. Nepřihlášený uživatel vidí statistiky.";

      boot("Boot: ready");
    } catch (err) {
      boot("Startup error: " + err.message);
      console.error(err);
    }
  })();
}
</script>
</body>
</html>
